<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>網頁切版練習</title>

    <link rel="stylesheet" type="text/css" href="./style.css">
</head>

<body>
    <!-- 導覽列 -->
    <div class="navbar">
        <div class="title">My Website</div>
        <div class="menu">
            <div class="menu-item">Item 1</div>
            <div class="menu-item">Item 2</div>
            <div class="menu-item">Item 3</div>
            <div class="menu-item">Item 4</div>
        </div>
        <div class="hamburger-icon" onclick="openMenu()"><img src="./img/menu.png" alt="hamburger icon"></div>
    </div>

    <div class="popup-menu" id="popup-menu">
        <div class="close-icon" onclick="closeMenu()"><img src="./img/close.png" alt="closs icon"></div>
        <div class="popup-menu-list">
            <div class="popup-menu-item">Item 1</div>
            <div class="popup-menu-item">Item 2</div>
            <div class="popup-menu-item">Item 3</div>
            <div class="popup-menu-item">Item 4</div>
        </div>
    </div>

    <!-- 大標題 -->
    <div class="welcome-container">
        <p>Welcome to MyHome</p>
    </div>

    <!-- 主要內容區 -->
    <div class="main-content">
        <div class="content-container" id="content-container">
        </div>
        <div class="button" id="load-more-button" onclick="loadMoreBlock()">Load More</div>
    </div>
    
</body>

<script>
    // 導覽選單收合
    function openMenu() {
        document.getElementById("popup-menu").classList.add("show");
    }

    function closeMenu() {
        document.getElementById("popup-menu").classList.remove("show");
    }

    // Load More 按鈕觸發函式
    let notShowIndex = 10; // 紀錄未顯示的"起始block"
    function loadMoreBlock() {
        const divContainer = document.querySelector(".content-container"); // container
        const divBlocks = divContainer.querySelectorAll(".block"); // container內的子元素blocks
        // 從"未顯示block"開始，往後顯示10個block
        for(let i=notShowIndex; i<(notShowIndex+10); i++) {
            // 超過"blocks總長"直接跳出
            if (i>=divBlocks.length)
                break;
            divBlocks[i].style.display = "flex";
        }
        notShowIndex += 10;
        // 如果全部blocks都已顯示，把 button 隱藏
        if (notShowIndex >= divBlocks.length) {
            const loadMoreButton = document.querySelector("#load-more-button");
            loadMoreButton.style.display = "none";
        }
    }

    // Promise.all() 會等待兩個 fetch 抓完才會進行下一步
    Promise.all([
        fetch("https://cwpeng.github.io/test/assignment-3-1").then(response => response.json()),
        fetch("https://cwpeng.github.io/test/assignment-3-2").then(response => response.json())
    ]).then(([textList, imgList]) => {
        // 取"景點名稱"
        const titleList = textList.rows.map(item => item.sname); 
        // 圖片網址host部分
        const imgUrlHost = imgList.host
        // 對應的景點img(第一張)網址
        const firstImgList = textList.rows.map(item => { // 用 map 遍歷10個景點
            // 用 find 找相對應serial的圖片物件
            const imgObject = imgList.rows.find(i => i.serial === item.serial);
            // 用 match 抓取第一張圖片.jpg的網址
            const firstImg = imgObject.pics.match(/.*?\.jpg/i);
            return firstImg[0]
        })
        
        // 開始建立圖卡
        let container = document.querySelector("#content-container");
        for(let i=0; i<titleList.length; i++) {
            // 建立4個標籤
            let div = document.createElement("div");
            let divImg = document.createElement("div");
            let img = document.createElement("img");
            let text = document.createElement("div");
            // 建立父子關係
            divImg.appendChild(img);
            div.appendChild(divImg);
            div.appendChild(text);
            container.appendChild(div);
            // 分成前三個元素跟之後的元素
            if (i < 3) {
                // 將整理完的 title, URL 指入屬性跟標籤
                img.src = imgUrlHost + firstImgList[i];
                img.alt = titleList[i];
                text.textContent = titleList[i];
                // 加 class
                div.classList.add("bar", "sm-12");
                divImg.classList.add("bar-img");
                text.classList.add("bar-text");
            }else {
                // 將整理完的 title, URL 指入屬性跟標籤
                div.style.backgroundImage = `url("${imgUrlHost + firstImgList[i]}")`;
                text.textContent = titleList[i];
                // 加 class
                div.classList.add("block", "sm-12"); 
                divImg.classList.add("block-star");
                text.classList.add("block-text");
                // 加星星
                img.src = "./img/star.png"; 
                img.alt = "star";
            }

            // 依照 index 規律增加 RWD 的 class
            if (i == 0) {
                div.classList.add("lg-12", "md-6");
            }else if (i == 1) {
                div.classList.add("lg-8", "md-6");
            }else if (i == 2) {
                div.classList.add("lg-4", "md-12");
            }else if ((i-2) % 5 == 1) {
                div.classList.add("lg-4", "md-3");
            }else if ((i-2) % 10 == 0 || (i-2) % 10 == 9) {
                div.classList.add("lg-2", "md-6");
            }else {
                div.classList.add("lg-2", "md-3");
            }

            // 先隱藏之後的 blocks
            if (i >= 13) {
                div.style.display = "none";
            }
        }
    })
    .catch(error => console.error("載入失敗", error));

</script>
</html>